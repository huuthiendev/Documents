DROP DATABASE IF EXISTS STORE247
CREATE DATABASE STORE247
USE STORE247

CREATE TABLE LOAISANPHAM(
    MALOAISP INT AUTO_INCREMENT,
    TENLOAISP NVARCHAR(100),
    MALOAICHA INT,
    
    CONSTRAINT KHOACHINH_LOAISANPHAM_MALOAI PRIMARY KEY (MALOAISP)
);

CREATE TABLE THUONGHIEU(
    MATH INT AUTO_INCREMENT,
    TENTH NVARCHAR(100),
    HINHTH TEXT,
    
    CONSTRAINT KHOACHINH_THUONGHIEU_MATH PRIMARY KEY (MATH)
);

CREATE TABLE CHITIETTHUONGHIEU(
    MATH INT,
    MALOAISP INT,
    HINHCTTH TEXT,
    
    CONSTRAINT KHOACHINH_CHITIETTHUONGHIEU_MATH_MALOAISP PRIMARY KEY (MATH, MALOAISP),
    CONSTRAINT KHOANGOAI_CHITIETTHUONGHIEU_MATH FOREIGN KEY (MATH) REFERENCES THUONGHIEU (MATH),
    CONSTRAINT KHOANGOAI_CHITIETTHUONGHIEU_MALOAISP FOREIGN KEY (MALOAISP) REFERENCES LOAISANPHAM (MALOAISP)
);

CREATE TABLE SANPHAM(
	MASP INT AUTO_INCREMENT,
    TENSP NVARCHAR(200),
    GIA DECIMAL,
    HINHSP TEXT,
    THONGTIN TEXT,
    MALOAISP INT,
    MATH INT,
	SOLUONG INT,
    LUOTMUA INT,
    
    CONSTRAINT KHOACHINH_SANPHAM_MASP PRIMARY KEY (MASP),
    CONSTRAINT KHOANGOAI_SANPHAM_MALOAISP FOREIGN KEY (MALOAISP) REFERENCES LOAISANPHAM (MALOAISP),
  	CONSTRAINT KHOANGOAI_SANPHAM_MATH FOREIGN KEY (MATH) REFERENCES THUONGHIEU (MATH)
);

CREATE TABLE CHITIETSANPHAM(
    MASP INT,
    TENCHITIET INT,
    GIATRI TEXT,
    
    CONSTRAINT KHOACHINH_CHITIETSANPHAM_MASP PRIMARY KEY (MASP),
    CONSTRAINT KHOANGOAI_CHITIETSANPHAM_MASP FOREIGN KEY (MASP) REFERENCES SANPHAM (MASP)
);

CREATE TABLE LOAINGUOIDUNG(
	MALOAIND INT AUTO_INCREMENT,
    TENLOAIND NVARCHAR(20),
    
    CONSTRAINT KHOACHINH_LOAINGUOIDUNG_MALOAINV PRIMARY KEY (MALOAIND)
);

CREATE TABLE NGUOIDUNG(
	MAND INT AUTO_INCREMENT,
    TENND NVARCHAR(100),
    TENDANGNHAP NVARCHAR(100),
    MATKHAU VARCHAR(100),
    DIACHI NVARCHAR(200),
    NGAYSINH VARCHAR(20),
    SDT VARCHAR(20),
    GIOITINH BOOLEAN,
    MALOAIND INT,
    
    CONSTRAINT KHOACHINH_NGUOIDUNG_MAND PRIMARY KEY (MAND),
    CONSTRAINT KHOANGOAI_NGUOIDUNG_MALOAINV FOREIGN KEY (MALOAIND) REFERENCES LOAINGUOIDUNG (MALOAIND)
);

CREATE TABLE KHUYENMAI(
    MAKM INT AUTO_INCREMENT,
    TENKM NVARCHAR (200),
    NGAYBD VARCHAR(20),
    NGAYKT VARCHAR(20),
    HINHKM TEXT,

    CONSTRAINT KHOACHINH_KHUYENMAI_MAKM PRIMARY KEY (MAKM),
);

CREATE TABLE CHITIETKHUYENMAI(
    MAKM INT,
	MASP INT,
    PHANTRAMKM INT(3),
    
    CONSTRAINT KHOACHINH_CHITIETKHUYENMAI_MASP_MAKM PRIMARY KEY (MASP, MAKM),
    CONSTRAINT KHOANGOAI_CHIETIETKUYENMAI_MASP FOREIGN KEY (MASP) REFERENCES SANPHAM (MASP),
    CONSTRAINT KHOANGOAI_CHITIETKHUYENMAI_MAKM FOREIGN KEY (MAKM) REFERENCES KHUYENMAI (MAKM)
);

CREATE TABLE BINHLUAN(
	MABL INT AUTO_INCREMENT,
    MAND INT,
    MASP INT,
    NOIDUNG TEXT,
    NGAYBL VARCHAR(50),
	MATRALOIBL INT,
    
    CONSTRAINT KHOACHINH_BINHLUAN_MAHD_MAND_MASP PRIMARY KEY (MABL, MAND, MASP),
    CONSTRAINT KHOANGOAI_BINHLUAN_MAND FOREIGN KEY (MAND) REFERENCES NGUOIDUNG (MAND),
    CONSTRAINT KHOANGOAI_BINHLUAN_MASP FOREIGN KEY (MASP) REFERENCES SANPHAM (MASP)
);

CREATE TABLE DANHGIA(
	MADG INT AUTO_INCREMENT,
	MASP INT,
	MAND INT,
	TIEUDE TEXT,
	NOIDUNG TEXT,
	SOSAO INT(1),
	NGAYDG VARCHAR(50),
	
	CONSTRAINT KHOACHINH_DANHGIA_MADG PRIMARY KEY (MADG),
    CONSTRAINT KHOANGOAI_DANHGIA_MASP FOREIGN KEY (MASP) REFERENCES SANPHAM (MASP),
	CONSTRAINT KHOANGOAI_DANHGIA_MAND FOREIGN KEY (MAND) REFERENCES NGUOIDUNG (MAND)
);

CREATE TABLE HOADON(
	MAHD INT AUTO_INCREMENT,
	MAND INT,
	DIACHI TEXT,
	TRANGTHAI INT(1),
	NGAYMUA VARCHAR(50),
	NGAYGIAO VARCHAR(50),
	CHUYENKHOAN BOOLEAN,
	MACHUYENKHOAN TEXT,

	CONSTRAINT KHOACHINH_HOADON_MAHD PRIMARY KEY (MAHD),
	CONSTRAINT KHOANGOAI_HOADON_MAND FOREIGN KEY (MAND) REFERENCES NGUOIDUNG (MAND)
);

CREATE TABLE CHITIETHOADON(
	MAHD INT,
	MASP INT,
	SOLUONG INT, 

	CONSTRAINT KHOACHINH_CHITIETHOADON_MAHD_MASP PRIMARY KEY (MAHD,MASP),
    CONSTRAINT KHOANGOAI_CHITIETHOADON_MAHD FOREIGN KEY (MAHD) REFERENCES HOADON (MAHD),
	CONSTRAINT KHOANGOAI_CHITIETHOADON_MASP FOREIGN KEY (MASP) REFERENCES SANPHAM (MASP),
);